<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>診断結果｜ギター占い</title>

  <!-- CSS（キャッシュ更新のため v=9 に） -->
  <link rel="stylesheet" href="style.css?v=9" />

  <!-- OGP（任意） -->
  <meta property="og:title" content="ギター占い｜診断結果">
  <meta property="og:description" content="あなたのギター気質は…？">
  <meta property="og:image" content="og.jpg">
  <meta name="twitter:card" content="summary_large_image">
</head>
<body>
  <header class="hero">
    <h1>ギター占い｜診断結果</h1>
    <p class="subtitle">あなたにぴったりの一本は…？🎸</p>
  </header>

  <div id="result">読み込み中…</div>

  <div class="actions" style="max-width:860px;margin:12px auto 0;text-align:center;">
    <a href="./" class="btn" rel="noopener">🔁 もう一度診断</a>
    <a id="shareX" target="_blank" class="btn" rel="noopener">🕊️ Xでシェア</a>
    <button id="copyLink" class="btn">🔗 リンクをコピー</button>
  </div>

  <script>
  (function () {
    // クエリ取得
    const key = new URLSearchParams(location.search).get("t");

    // タイプ辞書（12＋隠し4＋補助flyingv）
    const MAP = {
      strat:{ title:"Fender Stratocaster",  desc:"バランス良く社交的。対応力が高く、どんな場でも自分の色を出せる。", icon:"🎸" },
      tele:{ title:"Fender Telecaster",    desc:"誠実で実直。芯の強さと素朴な魅力で信頼を集める。", icon:"⭐" },
      lespaul:{ title:"Gibson Les Paul",    desc:"存在感と説得力。厚みのある言葉と行動で周囲を引っ張る。", icon:"🔥" },
      es335:{ title:"Gibson ES-335",        desc:"余裕と気品。落ち着きと柔らかさの両立で場をまとめる。", icon:"🎶" },
      ricken:{ title:"Rickenbacker",         desc:"センス派。独自のこだわりとキラリと光る個性で魅了する。", icon:"✨" },
      ibanez:{ title:"Ibanez",               desc:"先鋭・テク志向。新しい挑戦を楽しむ開拓タイプ。", icon:"⚡" },
      jazzmaster:{ title:"Fender Jazzmaster",desc:"オルタナ系。ひと味違う発想で創造性を発揮。", icon:"🌊" },
      prs:{ title:"PRS Custom 24",           desc:"高品位・万能型。仕上げ重視で完成度を高める職人肌。", icon:"💎" },
      sg:{ title:"Gibson SG",                desc:"直球勝負。スピード感と熱量で周囲を巻き込む。", icon:"🚀" },
      dane:{ title:"Danelectro",             desc:"軽快で遊び心。発想が柔らかく、ムードメーカー。", icon:"🍭" },
      mustang:{ title:"Fender Mustang",      desc:"身軽なチャレンジャー。小回りと瞬発力が武器。", icon:"🏃" },
      pacifica:{ title:"Yamaha Pacifica",    desc:"バランス型。実用性と安定感で成果を出す堅実派。", icon:"🧩" },
      // 隠しキャラ
      casino:{ title:"Epiphone Casino",      desc:"魅了と多面性。人を惹きつける交渉上手。", icon:"🎰" },
      yamahasg:{ title:"Yamaha SG",          desc:"重厚で堅実。腰の据わった安定の軸。", icon:"🛡️" },
      lpjr:{ title:"Gibson Les Paul Junior", desc:"最小限で最大。本質を突くミニマリスト。", icon:"🔧" },
      explorer:{ title:"Gibson Explorer",    desc:"開拓精神。未知を切り開くパイオニア。", icon:"🧭" },
      // 単独トップ保険
      flyingv:{ title:"Gibson Flying V",     desc:"勢いよく前へ。型にとらわれず道を切り開く挑戦者。", icon:"⚡" },
    };

    const $res = document.getElementById("result");

    try {
      // クエリがない／未知キーのときは丁寧に案内（真っ白回避）
      if (!key || !MAP[key]) {
        $res.innerHTML = `
          <span class="result-badge">お知らせ</span>
          結果キーが見つかりませんでした。<br>
          <a href="./" class="btn" style="margin-top:10px">トップへ戻る</a>
        `;
        return;
      }

      const data = MAP[key];
      document.title = `診断結果｜${data.title}｜ギター占い`;

      // 結果描画
      $res.innerHTML = `
        <span class="result-badge">診断結果</span>
        <strong>${data.icon || "🎸"} ${data.title}</strong> — ${data.desc}
      `;
      requestAnimationFrame(() => $res.classList.add('show'));

      // 共有＆コピー（トップURLを共有）
      const shareUrl = location.origin + location.pathname.replace(/result\.html$/,'');
      const shareText = `私は『${data.title}』タイプでした！ #ギター占い`;
      const share = document.getElementById("shareX");
      if (share) share.href =
        `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;

      const copyBtn = document.getElementById('copyLink');
      if (copyBtn){
        copyBtn.addEventListener('click', async () => {
          try{
            await navigator.clipboard.writeText(shareUrl);
            const old = copyBtn.textContent;
            copyBtn.textContent = 'コピーしました！';
            setTimeout(()=> copyBtn.textContent = old, 1600);
          }catch(e){ alert('コピーに失敗しました'); }
        });
      }
    } catch (err) {
      // 何かあっても真っ白にしない
      console.error(err);
      $res.innerHTML = `
        <span class="result-badge">エラー</span>
        予期しないエラーが発生しました。<br>
        <small style="opacity:.8">詳細: ${String(err.message || err)}</small><br>
        <a href="./" class="btn" style="margin-top:10px">トップへ戻る</a>
      `;
    }
  })();
  </script>
<script type="module">
  import { GUITARS } from "./data/guitarTypes.js";

  // --- タイプ名を正規化して揺れを吸収 ---
  function normalize(raw){
    let s = (raw || "").toLowerCase().trim();

    // 早期マッピング（ブランド付き・略称対応）
    const quick = s.replace(/\s+/g,"");
    const quickMap = {
      "es335": "es-335",
      "flyingv": "flying-v",
      "prscustom24": "prs-custom-24",
      "yamahapacifica": "yamaha-pacifica",
      "yamahasg": "yamaha-sg",
      "yamaha sg": "yamaha-sg",
      "lespauljr": "les-paul-junior",
      "lespauljunior": "les-paul-junior",
      "les paul jr": "les-paul-junior",
      "les paul junior": "les-paul-junior",
    };
    if (quickMap[quick]) return quickMap[quick];

    // ブランド名を先頭から除去（ただしYamaha SGはquickMapで先に保護済み）
    s = s.replace(/^(fender|gibson|epiphone|prs|yamaha)/, "");
    s = s.replace(/\s+/g,""); // スペース除去

    // ゆれ対応
    const map = {
      "lespaul": "les-paul",
      "es335": "es-335",
      "prscustom24": "prs-custom-24",
      "flyingv": "flying-v",
      "yamahapacifica": "yamaha-pacifica",
      "casino": "casino",
      "explorer": "explorer",
      "rickenbacker": "rickenbacker",
      "telecaster": "telecaster",
      "stratocaster": "stratocaster",
      "jazzmaster": "jazzmaster",
      "ibanez": "ibanez",
      "sg": "sg",
      "danelectro": "danelectro",
      "mustang": "mustang",
      "pacifica": "yamaha-pacifica" // 俗称
    };
    return map[s] || s;
  }

  // --- キーを決定する ---
  function getKey(){
    const params = new URLSearchParams(location.search);
    let key = normalize(params.get("type"));

    // localStorage fallback
    if(!key){
      try{
        const saved = JSON.parse(localStorage.getItem("guitar_diagnosis")||"{}");
        if (saved.resultKey) key = normalize(saved.resultKey);
      }catch(_){}
    }

    // ページ上の診断結果名から拾う（#resultName があればベスト）
    if(!key){
      const nameEl =
        document.querySelector("#resultName") ||
        document.querySelector(".result-name, .resultTitle, .badge, .pill, h2, h3");
      if(nameEl && nameEl.textContent){
        key = normalize(nameEl.textContent);
      }
    }

    if(!GUITARS[key]) key = "stratocaster"; // デフォルト
    return key;
  }

  const key = getKey();
  const d = GUITARS[key];

  // --- スタイル注入 ---
  const style = document.createElement("style");
  style.textContent = `
    .g-detail-card{max-width:1000px;margin:24px auto;padding:20px;border-radius:16px;
      background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.12)}
    .g-hero{display:grid;grid-template-columns:1.2fr 1fr;gap:16px;align-items:stretch}
    .g-img{width:100%;height:100%;object-fit:contain;background:rgba(255,255,255,0.04);border-radius:12px}
    .g-info h2{margin:.2rem 0;font-size:1.6rem;font-weight:800}
    .g-tag{display:inline-block;margin-bottom:.5rem;padding:.25rem .6rem;border-radius:999px;
      font-size:.8rem;background:rgba(147,197,253,.15);border:1px solid rgba(147,197,253,.35)}
    .g-tagline{opacity:.85;margin:.25rem 0 1rem}
    .g-persona{opacity:.9}
    .g-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .g-sec{padding:12px;border-radius:12px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.08)}
    .g-sec h3{margin:.2rem 0 .4rem;font-size:1rem;opacity:.9}
    .g-sec ul{margin:.2rem 0 .4rem 1.2rem}
    @media (max-width:860px){.g-hero{grid-template-columns:1fr}}
  `;
  document.head.appendChild(style);

  // --- カードを生成してページ末尾に追加 ---
  const host = document.querySelector("main") || document.querySelector("#app") || document.body;
  const card = document.createElement("section");
  card.className = "g-detail-card";
  card.innerHTML = `
    <div class="g-hero">
      <img class="g-img" src="${d.image}" alt="${d.name}">
      <div class="g-info">
        <span class="g-tag">GUITAR TYPE</span>
        <h2>${d.name}</h2>
        <p class="g-tagline">${d.tagline}</p>
        <p class="g-persona">${d.persona}</p>
        <div class="g-grid">
          <div class="g-sec">
            <h3>強み</h3>
            <ul>${d.strengths.map(s=>`<li>${s}</li>`).join("")}</ul>
          </div>
          <div class="g-sec">
            <h3>気をつけたい点</h3>
            <ul>${d.caution.map(s=>`<li>${s}</li>`).join("")}</ul>
          </div>
        </div>
        <div class="g-sec"><h3>アドバイス（仕事/恋愛）</h3><p>${d.loveWorkTips}</p></div>
        <div class="g-sec"><h3>相性が良いタイプ</h3><p>${d.matches.join(" / ")}</p></div>
      </div>
    </div>
  `;
  host.appendChild(card);
</script>
</body>
</html>
