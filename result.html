<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è¨ºæ–­çµæœï½œã‚®ã‚¿ãƒ¼å ã„</title>

  <!-- CSSï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ã®ãŸã‚ v=9 ã«ï¼‰ -->
  <link rel="stylesheet" href="style.css?v=9" />

  <!-- OGPï¼ˆä»»æ„ï¼‰ -->
  <meta property="og:title" content="ã‚®ã‚¿ãƒ¼å ã„ï½œè¨ºæ–­çµæœ">
  <meta property="og:description" content="ã‚ãªãŸã®ã‚®ã‚¿ãƒ¼æ°—è³ªã¯â€¦ï¼Ÿ">
  <meta property="og:image" content="og.jpg">
  <meta name="twitter:card" content="summary_large_image">
</head>
<body>
  <header class="hero">
    <h1>ã‚®ã‚¿ãƒ¼å ã„ï½œè¨ºæ–­çµæœ</h1>
    <p class="subtitle">ã‚ãªãŸã«ã´ã£ãŸã‚Šã®ä¸€æœ¬ã¯â€¦ï¼ŸğŸ¸</p>
  </header>

  <div id="result">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

  <div class="actions" style="max-width:860px;margin:12px auto 0;text-align:center;">
    <a href="./" class="btn" rel="noopener">ğŸ” ã‚‚ã†ä¸€åº¦è¨ºæ–­</a>
    <a id="shareX" target="_blank" class="btn" rel="noopener">ğŸ•Šï¸ Xã§ã‚·ã‚§ã‚¢</a>
    <button id="copyLink" class="btn">ğŸ”— ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
  </div>

 
<script type="module">
  import { GUITARS } from "./data/guitarTypes.js";

  // ---- ã‚­ãƒ¼å–å¾—ï¼šURL > localStorage ã®é †ã€‚DOMã¯èª­ã¾ãªã„ ----
  function getKeyStrict() {
    const params = new URLSearchParams(location.search);
    let key = params.get("type")?.trim().toLowerCase() || "";
    if (!key) {
      try {
        const saved = JSON.parse(localStorage.getItem("guitar_diagnosis") || "{}");
        if (saved && typeof saved.resultKey === "string") key = saved.resultKey.toLowerCase();
      } catch {}
    }
    return key;
  }

  // ---- è¡¨è¨˜ã‚†ã‚Œè£œæ­£ï¼ˆå¿…è¦æœ€å°é™ï¼‰ ----
  function normalize(key) {
    const s = (key || "").replace(/\s+/g, "");
    const map = {
      "es335":"es-335",
      "flyingv":"flying-v",
      "prscustom24":"prs-custom-24",
      "yamahapacifica":"yamaha-pacifica",
      "yamahasg":"yamaha-sg",
      "lespaul":"les-paul",
      "lespauljr":"les-paul-junior",
      "lespauljunior":"les-paul-junior",
      "pacifica":"yamaha-pacifica"
    };
    return map[s] || key;
  }

  let key = normalize(getKeyStrict());

  // ä¸æ˜ã ã£ãŸã‚‰æ˜ç¤ºçš„ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼ˆè‡ªå‹•Stratãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ã—ãªã„ï¼‰
  if (!GUITARS[key]) {
    console.error("[guitar-fortune] Unknown result key:", key);
    const err = document.createElement("div");
    err.style.maxWidth = "1000px";
    err.style.margin = "24px auto";
    err.style.padding = "16px";
    err.style.borderRadius = "12px";
    err.style.border = "1px solid rgba(255,0,0,.25)";
    err.style.background = "rgba(255,0,0,.06)";
    err.style.color = "#ffd5d5";
    err.innerHTML = `
      <strong>çµæœã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</strong><br>
      URLã« <code>?type=telecaster</code> ã®ã‚ˆã†ã«ä»˜ã‘ã‚‹ã‹ã€é›†è¨ˆæ™‚ã«
      <code>localStorage.setItem("guitar_diagnosis", JSON.stringify({ resultKey: "telecaster" }))</code>
      ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
    `;
    (document.querySelector("main") || document.body).appendChild(err);
    throw new Error("Unknown result key");
  }

  const d = GUITARS[key];
// ---- ä¸Šéƒ¨ã® #result ã‚’å·®ã—æ›¿ãˆ ----
const $res = document.getElementById("result");
if ($res) {
  $res.innerHTML = `
    <span class="result-badge">è¨ºæ–­çµæœ</span>
    <strong>${d.name}</strong> â€” ${d.tagline}
  `;
  $res.classList.add("show");
}

  // ---- ã‚¹ã‚¿ã‚¤ãƒ«æ³¨å…¥ ----
  const style = document.createElement("style");
  style.textContent = `
    .g-detail-card{max-width:1000px;margin:24px auto;padding:20px;border-radius:16px;
      background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.12)}
    .g-hero{display:grid;grid-template-columns:1.2fr 1fr;gap:16px;align-items:stretch}
    .g-img{width:100%;height:100%;object-fit:contain;background:rgba(255,255,255,0.04);border-radius:12px}
    .g-info h2{margin:.2rem 0;font-size:1.6rem;font-weight:800}
    .g-tag{display:inline-block;margin-bottom:.5rem;padding:.25rem .6rem;border-radius:999px;
      font-size:.8rem;background:rgba(147,197,253,.15);border:1px solid rgba(147,197,253,.35)}
    .g-tagline{opacity:.85;margin:.25rem 0 1rem}
    .g-persona{opacity:.9}
    .g-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .g-sec{padding:12px;border-radius:12px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.08)}
    .g-sec h3{margin:.2rem 0 .4rem;font-size:1rem;opacity:.9}
    .g-sec ul{margin:.2rem 0 .4rem 1.2rem}
    @media (max-width:860px){.g-hero{grid-template-columns:1fr}}
  `;
  document.head.appendChild(style);

  // ---- ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ ----
  const host = document.querySelector("main") || document.querySelector("#app") || document.body;
  const card = document.createElement("section");
  card.className = "g-detail-card";
  card.innerHTML = `
    <div class="g-hero">
      <img class="g-img" src="${d.image}" alt="${d.name}">
      <div class="g-info">
        <span class="g-tag">GUITAR TYPE</span>
        <h2>${d.name}</h2>
        <p class="g-tagline">${d.tagline}</p>
        <p class="g-persona">${d.persona}</p>
        <div class="g-grid">
          <div class="g-sec">
            <h3>å¼·ã¿</h3>
            <ul>${d.strengths.map(s=>`<li>${s}</li>`).join("")}</ul>
          </div>
          <div class="g-sec">
            <h3>æ°—ã‚’ã¤ã‘ãŸã„ç‚¹</h3>
            <ul>${d.caution.map(s=>`<li>${s}</li>`).join("")}</ul>
          </div>
        </div>
        <div class="g-sec"><h3>ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆä»•äº‹/æ‹æ„›ï¼‰</h3><p>${d.loveWorkTips}</p></div>
        <div class="g-sec"><h3>ç›¸æ€§ãŒè‰¯ã„ã‚¿ã‚¤ãƒ—</h3><p>${d.matches.join(" / ")}</p></div>
      </div>
    </div>
  `;
  host.appendChild(card);
  // ---- ã“ã“ã‹ã‚‰ã€Œã‚‚ã£ã¨è©³ã—ãå ã†ãªã‚‰ã€ãƒ–ãƒ­ãƒƒã‚¯ ----
const promo = document.createElement("div");
promo.className = "g-sec";
promo.style.marginTop = "20px";
promo.style.textAlign = "center";
promo.innerHTML = `
  <h3>ğŸ”® ã‚‚ã£ã¨è©³ã—ãå ã†ãªã‚‰</h3>
  <p>AIã¨çµ±è¨ˆå­¦ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸã€å é«­è–ãƒ©ã‚¸ãƒ£ã®æœ¬æ ¼é‘‘å®šã¯ã“ã¡ã‚‰ã‹ã‚‰</p>
  <p>
    <a href="https://twitter.com/senbiseiraja" target="_blank" class="btn">ğŸ•Šï¸ Xã§æœ€æ–°æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯</a>
    <a href="https://coconala.com/users/5422205" target="_blank" class="btn">ğŸŒ™ ã‚³ã‚³ãƒŠãƒ©é‘‘å®šã¯ã“ã¡ã‚‰</a>
  </p>
`;
host.appendChild(promo);
// ---- ã“ã“ã¾ã§ ----

  // ---- å…±æœ‰ãƒªãƒ³ã‚¯ã¨ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ----

// å…±æœ‰ã™ã‚‹URLï¼ˆãƒˆãƒƒãƒ—ï¼index.html ã®ã‚ã‚‹å ´æ‰€ã‚’æƒ³å®šï¼‰
const baseUrl = new URL(".", location.href).href; // ä¾‹: https://user.github.io/repo/
const shareText = `ç§ã¯ã€${d.name}ã€ã‚¿ã‚¤ãƒ—ã§ã—ãŸï¼ #ã‚®ã‚¿ãƒ¼å ã„`;

// X(Twitter)ï¼šintent URL ã‚’ã‚»ãƒƒãƒˆ
const shareX = document.getElementById("shareX");
if (shareX) {
  const intent = new URL("https://twitter.com/intent/tweet");
  intent.searchParams.set("text", shareText);
  intent.searchParams.set("url", baseUrl);
  shareX.href = intent.toString();

  // Web Share API ãŒä½¿ãˆã‚‹ãªã‚‰ã€ã‚¯ãƒªãƒƒã‚¯ã§ãƒã‚¤ãƒ†ã‚£ãƒ–å…±æœ‰ã«åˆ‡æ›¿
  if (navigator.share) {
    shareX.addEventListener("click", async (e) => {
      e.preventDefault();
      try {
        await navigator.share({ title: "ã‚®ã‚¿ãƒ¼å ã„", text: shareText, url: baseUrl });
      } catch (_) { /* ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯ä½•ã‚‚ã—ãªã„ */ }
    });
  }
}

// ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼
const copyBtn = document.getElementById("copyLink");
if (copyBtn) {
  copyBtn.addEventListener("click", async () => {
    const text = baseUrl;
    try {
      if (navigator.clipboard?.writeText) {
        await navigator.clipboard.writeText(text);
      } else {
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆHTTPSä»¥å¤–ã‚„æ¨©é™ãªã—ç’°å¢ƒç”¨ï¼‰
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.opacity = "0";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
      const old = copyBtn.textContent;
      copyBtn.textContent = "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼";
      setTimeout(() => (copyBtn.textContent = old), 1400);
    } catch (err) {
      alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
      console.error(err);
    }
  });
}

</script>
</body>
</html>
